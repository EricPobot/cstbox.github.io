

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>service - Fundation classes for services implementation &mdash; CSTBox 1.0 documentation</title>
  

  
  

  

  
  
    

  

  
  
    <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  

  

  
    <link rel="top" title="CSTBox 1.0 documentation" href="../index.html"/>
        <link rel="up" title="Core system" href="../core.html"/>
        <link rel="next" title="statemgr - State variables management" href="statemgr.html"/>
        <link rel="prev" title="log - Customized logging system" href="log.html"/> 

  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-nav-search">
        

        
          <a href="../index.html" class="icon icon-home"> CSTBox
        

        
        </a>

        
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

        
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
        
          
          
              <ul class="current">
<li class="toctree-l1 current"><a class="reference internal" href="../api.html">CSTBox API documentation</a><ul class="current">
<li class="toctree-l2 current"><a class="reference internal" href="../core.html">Core system</a><ul class="current">
<li class="toctree-l3"><a class="reference internal" href="cfgbroker.html">cfgbroker - Device network configuration access service</a></li>
<li class="toctree-l3"><a class="reference internal" href="cli.html">cli - Command line interface helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="config.html">config - System wide configuration</a></li>
<li class="toctree-l3"><a class="reference internal" href="cron.html">cron - CSTBox crontab management</a></li>
<li class="toctree-l3"><a class="reference internal" href="dbuslib.html">dbuslib - D-Bus helpers</a></li>
<li class="toctree-l3"><a class="reference internal" href="devcfg.html">devcfg - Devices network configuration data access tools</a></li>
<li class="toctree-l3"><a class="reference internal" href="events.html">events - Basic definitions and tools related to CSTBox events</a></li>
<li class="toctree-l3"><a class="reference internal" href="evtmgr.html">evtmgr - CSTBox Event manager service</a></li>
<li class="toctree-l3"><a class="reference internal" href="export.html">export - Events data export</a></li>
<li class="toctree-l3"><a class="reference internal" href="flags.html">flags - Notification flags management</a></li>
<li class="toctree-l3"><a class="reference internal" href="hal.html">hal - Hardware Abstraction Layer package</a><ul>
<li class="toctree-l4"><a class="reference internal" href="hal.html#sub-package-content">Sub-package content</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="log.html">log - Customized logging system</a></li>
<li class="toctree-l3 current"><a class="current reference internal" href="">service - Fundation classes for services implementation</a></li>
<li class="toctree-l3"><a class="reference internal" href="statemgr.html">statemgr - State variables management</a><ul>
<li class="toctree-l4"><a class="reference internal" href="statemgr.html#module-pycstbox.statemgr.core">statemgr.core</a></li>
<li class="toctree-l4"><a class="reference internal" href="statemgr.html#module-pycstbox.statemgr.mgr">statemgr.mgr</a></li>
<li class="toctree-l4"><a class="reference internal" href="statemgr.html#module-pycstbox.statemgr.dbus_binding">statemgr.dbus_binding</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="sysutils.html">sysutils - CSTBox system level utilities</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../extensions.html">Extensions</a><ul>
<li class="toctree-l3"><a class="reference internal" href="../extensions.html#devices-support-extensions">Devices support extensions</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../extensions.html#protocol-enablers">Protocol enablers</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extensions.html#products-drivers">Products drivers</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="../extensions.html#optional-services">Optional services</a><ul>
<li class="toctree-l4"><a class="reference internal" href="../extensions/webui.html">webui - CSTBox Web based user interface</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extensions/evtdb.html">evtdb - CSTBox Events Database access D-Bus service</a></li>
<li class="toctree-l4"><a class="reference internal" href="../extensions/mqtt.html">mqtt - MQTT gateway extension</a></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

          
        
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../index.html">CSTBox</a>
      </nav>


      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../index.html">Docs</a> &raquo;</li>
      
          <li><a href="../api.html">CSTBox API documentation</a> &raquo;</li>
      
          <li><a href="../core.html">Core system</a> &raquo;</li>
      
    <li>service - Fundation classes for services implementation</li>
      <li class="wy-breadcrumbs-aside">
        
          
        
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document">
            
  <div class="section" id="module-pycstbox.service">
<span id="service-fundation-classes-for-services-implementation"></span><h1>service - Fundation classes for services implementation<a class="headerlink" href="#module-pycstbox.service" title="Permalink to this headline">¶</a></h1>
<p>Root class and helpers for implementing CSTBox D-Bus based services.</p>
<p>The concept of service container is provided to leverage the possibility of
accessing several service objects through a single bus name. This container takes
care of running the main loop and catching signals to terminating it gracefully.</p>
<p>Services objects are added to the container to provide the required services, each
one being associated to a given path inside the container.</p>
<dl class="class">
<dt id="pycstbox.service.ServiceContainer">
<em class="property">class </em><code class="descclassname">pycstbox.service.</code><code class="descname">ServiceContainer</code><span class="sig-paren">(</span><em>name</em>, <em>conn=None</em>, <em>svc_objects=None</em>, <em>auto_fw_object=True</em><span class="sig-paren">)</span><a class="headerlink" href="#pycstbox.service.ServiceContainer" title="Permalink to this definition">¶</a></dt>
<dd><p>A service container is used to host one or many service objects, made accessible
via its connection to a bus.</p>
<p>Service objects can be added either at container creation time or afterwards.</p>
<p>A service object providing framework level features, such as termination request is
automatically created and added (unless specified otherwise). Its path is defined
by the SYSTEM_OBJECT_PATH constant.</p>
<dl class="docutils">
<dt>Simple usage :</dt>
<dd><dl class="first docutils">
<dt>class SvcObject1(dbus.service.Object):</dt>
<dd>...</dd>
<dt>class SvcObject2(dbus.service.Object):</dt>
<dd>...</dd>
</dl>
<p>obj1 = SvcObject1(...)
obj2 = SvcObject2(...)
svc = ServiceContainer(</p>
<blockquote>
<div>&#8216;my_service&#8217;,         &#8211;&gt; will claim &#8216;fr.cstb.cstbox.my_service&#8217; bus name on SessionBus
[(obj1, &#8216;/path/to/obj1&#8217;),(obj2, &#8216;/path/to/obj2&#8217;)]
)</div></blockquote>
<p class="last">svc.start()</p>
</dd>
</dl>
<p>Since automatic framework service object has been used (default),
it is then possible possible to send to fr.cstb.cstbox.my_service a
a method call message to framework.terminate</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>name</strong> (<em>str</em>) &#8211; the container&#8217;s name. It is used to build the well-known name which will
be claimed (see pycstbox.commons.make_bus_name())</li>
<li><strong>conn</strong> (<em>dbus_connection</em>) &#8211; the connection to the bus used by the service.
Set to the session bus if not provided.</li>
<li><strong>svc_objects</strong> (<em>list</em>) &#8211; an optional list of service objects, which will be automatically added to
the container during its initialization. The items of this list are tuples
containing the service object instance and the path to be associated for it</li>
<li><strong>auto_fw_object</strong> (<em>bool</em>) &#8211; if True (the default) a service object implementing framework level functions
is automatically created and added. If False, it is the responsibility of
the application to provide it and adding it if framework level functions are
required.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="method">
<dt id="pycstbox.service.ServiceContainer.log_setLevel">
<code class="descname">log_setLevel</code><span class="sig-paren">(</span><em>level</em><span class="sig-paren">)</span><a class="headerlink" href="#pycstbox.service.ServiceContainer.log_setLevel" title="Permalink to this definition">¶</a></dt>
<dd><p>Local override of log_setLevel fo handing the propagation of the
level setting to the child service objects.</p>
</dd></dl>

<dl class="method">
<dt id="pycstbox.service.ServiceContainer.add">
<code class="descname">add</code><span class="sig-paren">(</span><em>svc_object</em>, <em>path</em><span class="sig-paren">)</span><a class="headerlink" href="#pycstbox.service.ServiceContainer.add" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a service object to the container.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>svc_object</strong> (<em>ServiceObject</em>) &#8211; the service object</li>
<li><strong>path</strong> (<em>str</em>) &#8211; the path to which the object is accessed</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Raises ValueError:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body"><p class="first last">if parameters are None or not the right type</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pycstbox.service.ServiceContainer.add_objects">
<code class="descname">add_objects</code><span class="sig-paren">(</span><em>svc_objects</em><span class="sig-paren">)</span><a class="headerlink" href="#pycstbox.service.ServiceContainer.add_objects" title="Permalink to this definition">¶</a></dt>
<dd><p>Adds a list of service object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>svc_objects</strong> (<em>list</em>) &#8211; an optional list of service objects, which will be automatically added to
the container during its initialization. The items of this list are tuples
containing the service object instance and the path to be associated for it</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pycstbox.service.ServiceContainer.remove">
<code class="descname">remove</code><span class="sig-paren">(</span><em>svc_object</em><span class="sig-paren">)</span><a class="headerlink" href="#pycstbox.service.ServiceContainer.remove" title="Permalink to this definition">¶</a></dt>
<dd><p>Removes a service object from the container.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>svc_object</strong> (<em>ServiceObject</em>) &#8211; the service object to be removed</td>
</tr>
<tr class="field-even field"><th class="field-name" colspan="2">Raises ValueError:</th></tr>
<tr class="field-even field"><td>&nbsp;</td><td class="field-body">if parameter is None or not the right type</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="pycstbox.service.ServiceContainer.start">
<code class="descname">start</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycstbox.service.ServiceContainer.start" title="Permalink to this definition">¶</a></dt>
<dd><p>Starts the container.</p>
<p>This starts the D-Bus main loop and allows the service to receive calls and signals
from the outside.</p>
<p>The container can be stopped then by :
- calling its terminate() method
- sending it a SIGTERM signal or a KeyboardInterrupt</p>
<p>Starting a running container has no effect, apart a warning message in the log.</p>
</dd></dl>

<dl class="method">
<dt id="pycstbox.service.ServiceContainer.terminate">
<code class="descname">terminate</code><span class="sig-paren">(</span><span class="sig-paren">)</span><a class="headerlink" href="#pycstbox.service.ServiceContainer.terminate" title="Permalink to this definition">¶</a></dt>
<dd><p>Stops the container.</p>
<p>This makes the event loop to exit and resources to be freed.</p>
<p>Stopping a not running container has no effect, apart a warning message in the log.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="pycstbox.service.SimpleService">
<em class="property">class </em><code class="descclassname">pycstbox.service.</code><code class="descname">SimpleService</code><span class="sig-paren">(</span><em>name</em>, <em>conn=None</em>, <em>path='/service'</em><span class="sig-paren">)</span><a class="headerlink" href="#pycstbox.service.SimpleService" title="Permalink to this definition">¶</a></dt>
<dd><p>This class is just a helper for implementation of a service composed of
a single object.</p>
<p>It is an hybrid class which packages the service container and the service object,
and &#8220;connects&#8221; them automatically. If not provided, the service object path
is set to &#8216;/service&#8217;.</p>
<p>It must be sub-classed to implement the required methods and/or signals.</p>
<p><strong>IMPORTANT</strong> don&#8217;t use this for the moment, it is a bit buggy</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>path</strong> (<em>str</em>) &#8211; the path to be associated to the service object. Default: &#8216;/service&#8217;</td>
</tr>
</tbody>
</table>
<p>For other parameters, see <a class="reference internal" href="#pycstbox.service.ServiceContainer" title="pycstbox.service.ServiceContainer"><code class="xref py py-class docutils literal"><span class="pre">ServiceContainer</span></code></a></p>
</dd></dl>

</div>


          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="statemgr.html" class="btn btn-neutral float-right" title="statemgr - State variables management" accesskey="n">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="log.html" class="btn btn-neutral" title="log - Customized logging system" accesskey="p"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'../',
            VERSION:'1.0',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true
        };
    </script>
      <script type="text/javascript" src="../_static/jquery.js"></script>
      <script type="text/javascript" src="../_static/underscore.js"></script>
      <script type="text/javascript" src="../_static/doctools.js"></script>

  

  
  
    <script type="text/javascript" src="../_static/js/theme.js"></script>
  

  
  
  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.StickyNav.enable();
      });
  </script>
   

</body>
</html>